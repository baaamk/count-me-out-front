{
  "rules": {
    "settlements": {
      "$roomId": {
        ".read": true,
        ".write": true,
        "id": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "type": {
          ".validate": "newData.isString() && (newData.val() === 'receipt' || newData.val() === 'taxi')"
        },
        "createdAt": {
          ".validate": "newData.isNumber()"
        },
        "status": {
          ".validate": "newData.isString() && (newData.val() === 'active' || newData.val() === 'completed')"
        },
        "host": {
          "nickname": {
            ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 20"
          },
          "kakaoPayCode": {
            ".validate": "newData.isString() || newData.val() === null"
          },
          "bank": {
            ".validate": "newData.isString() && newData.val().length > 0"
          },
          "accountNumber": {
            ".validate": "newData.isString() && newData.val().length > 0"
          }
        },
        "menuItems": {
          "$menuId": {
            "id": {
              ".validate": "newData.isNumber()"
            },
            "name": {
              ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 50"
            },
            "price": {
              ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 10000000"
            },
            "quantity": {
              ".validate": "newData.isNumber() && newData.val() > 0 && newData.val() <= 100"
            },
            "participantCount": {
              ".validate": "newData.isNumber() && newData.val() >= 0"
            },
            "pricePerPerson": {
              ".validate": "newData.isNumber() && newData.val() >= 0"
            },
            "participants": {
              ".validate": "newData.hasChildren() || newData.val() === null"
            }
          }
        },
        "taxiInfo": {
          "departure": {
            "name": {
              ".validate": "newData.isString() && newData.val().length > 0"
            },
            "lat": {
              ".validate": "newData.isNumber() && newData.val() >= -90 && newData.val() <= 90"
            },
            "lng": {
              ".validate": "newData.isNumber() && newData.val() >= -180 && newData.val() <= 180"
            }
          },
          "arrival": {
            "name": {
              ".validate": "newData.isString() && newData.val().length > 0"
            },
            "lat": {
              ".validate": "newData.isNumber() && newData.val() >= -90 && newData.val() <= 90"
            },
            "lng": {
              ".validate": "newData.isNumber() && newData.val() >= -180 && newData.val() <= 180"
            }
          },
          "totalAmount": {
            ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 1000000"
          },
          "participantOrders": {
            ".validate": "newData.hasChildren() || newData.val() === null"
          },
          "calculatedTaxiFare": {
            "total": {
              ".validate": "newData.isNumber() && newData.val() >= 0"
            },
            "breakdown": {
              ".validate": "newData.hasChildren() || newData.val() === null"
            }
          },
          "calculatedRoute": {
            "distance": {
              ".validate": "newData.isNumber() && newData.val() >= 0"
            },
            "duration": {
              ".validate": "newData.isNumber() && newData.val() >= 0"
            },
            "taxiFare": {
              ".validate": "newData.isNumber() && newData.val() >= 0"
            },
            "waypoints": {
              ".validate": "newData.hasChildren() || newData.val() === null"
            }
          }
        },
        "participants": {
          "$nickname": {
            "nickname": {
              ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 20"
            },
            "isHost": {
              ".validate": "newData.isBoolean()"
            },
            "selectedMenuIds": {
              ".validate": "newData.hasChildren() || newData.val() === null"
            },
            "selectedLocation": {
              "name": {
                ".validate": "newData.isString() && newData.val().length > 0"
              },
              "lat": {
                ".validate": "newData.isNumber() && newData.val() >= -90 && newData.val() <= 90"
              },
              "lng": {
                ".validate": "newData.isNumber() && newData.val() >= -180 && newData.val() <= 180"
              }
            },
            "completed": {
              ".validate": "newData.isBoolean()"
            },
            "joinedAt": {
              ".validate": "newData.isNumber()"
            },
            "completedAt": {
              ".validate": "newData.isNumber() || newData.val() === null"
            },
            "participants": {
              ".validate": "newData.hasChildren() || newData.val() === null"
            }
          }
        },
        "totalParticipants": {
          ".validate": "newData.isNumber() && newData.val() >= 1 && newData.val() <= 100"
        },
        "currentParticipants": {
          ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= newData.parent().parent().child('totalParticipants').val()"
        }
      },
      ".read": false,
      ".write": false
    }
  }
}

